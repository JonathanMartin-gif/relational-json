<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>relational-json by SebastienDaniel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">relational-json</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/SebastienDaniel/relational-json" class="btn">View on GitHub</a>
      <a href="https://github.com/SebastienDaniel/relational-json/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/SebastienDaniel/relational-json/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><strong>relational-json</strong> makes working with complex data simpler than ever.</p>

<h1>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting started</h1>

<h3>
<a id="install-relational-json" class="anchor" href="#install-relational-json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install relational-json</h3>

<p><code>npm install relational-json --save</code></p>

<h3>
<a id="require" class="anchor" href="#require" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Require</h3>

<p>Relational-json is quite straight-forward. You require relational-json into your source:</p>

<p><code>var rJSON = require("relational-json");</code></p>

<p>and you create a db based on a schema you provide:</p>

<p><code>var db = rJSON(schema);</code></p>

<hr>

<h3>
<a id="how-it-works" class="anchor" href="#how-it-works" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How it works</h3>

<p>Relational-json wraps your primitive data (<em>strings, numbers, booleans</em>) in an immutable &amp; relational structure. The format is just like JSON, except your data can reference other parts of your data tree. This is done dynamically, thanks to ES5 object getters &amp; setters.
Each object created inside relational-json is "pure", in the sense that it has no native prototype. This allows us to leverage JavaScripts prototypical inheritance in very elegant ways.</p>

<p>relational-json is JSON with conscience.</p>

<h3>
<a id="why-use-it" class="anchor" href="#why-use-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why use it</h3>

<p>When building web applications you'll be dealing with a wide variety of data and multiple data sources. Managing application state updates can quickly become problematic, especially when certain data branches rely on other branches. When you update a value, you have to make sure the change propagates everywhere. Relational-json makes all of that simpler:</p>

<ol>
<li>It eliminates data duplication</li>
<li>It simplifies data updates (<em>you only ever need to modify data in 1 place, since there are no duplicates</em>)</li>
<li>It encapsulates your data, data manipulation logic and restricts certain operations (<em>such as wrong datatype in a given field</em>)</li>
<li>It's extremely portable, since the data uses the well-known JSON syntax.</li>
<li>It makes no environment assumptions (<em>can be used in browser, on node, etc.</em>)</li>
</ol>

<h2>
<a id="limitation" class="anchor" href="#limitation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Limitation</h2>

<p>Because of it's referential nature, <code>JSON.stringify()</code> does not work as expected. This is due to <em>infinite nesting</em>, which makes you
jump from prototype to child and back again, infinitely, if you don't control the data traversal.
(<em>we provide a simple utility, which entirely mitigates the issue</em>)</p>

<p>Also, relational-json is IE9+ compatible, but <strong>cannot be shimmed or polyfilled</strong> for older browsers.</p>

<hr>

<h2>
<a id="the-schema" class="anchor" href="#the-schema" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The schema</h2>

<p>Relational-json expects a javascript-object schema representing the data tree you wish to use. Below is a full break down of the schema notation:</p>

<div class="highlight highlight-source-js"><pre>{
    tableName<span class="pl-k">:</span> {
        primary<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>field to use as unique identifier. Field must be in fields object.<span class="pl-pds">"</span></span>,
        fields<span class="pl-k">:</span> {
            fieldName<span class="pl-k">:</span> {
                allowNull<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>can the value be set to null (true / false)<span class="pl-pds">"</span></span>,
                dataType<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>datatype of the field (string, integer, float, date, time, datetime, boolean)<span class="pl-pds">"</span></span>,
                defaultValue<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>value to use if none provided at creation time<span class="pl-pds">"</span></span>
            }
        },
        extends<span class="pl-k">:</span> {
            table<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>tableName that is a parent of this table<span class="pl-pds">"</span></span>,
            localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>own field that references parent table<span class="pl-pds">"</span></span>,
            foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>parent table field that localField is matched with<span class="pl-pds">"</span></span>
        },
        aggregates<span class="pl-k">:</span> [
            {
                table<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>tableName that is aggregated<span class="pl-pds">"</span></span>,
                alias<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>property alias to use for relation<span class="pl-pds">"</span></span>,
                localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>local field used to build aggregate relations<span class="pl-pds">"</span></span>,
                foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>foreign field used in aggregate relation<span class="pl-pds">"</span></span>,
                cardinality<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>(single / many), a single relation provides a direct relation to another object. A many relation creates an array of objects<span class="pl-pds">"</span></span>
            }
        ]
    }
}</pre></div>

<p>Table fields can also be written in shorthand. This creates a field that has <em>no defaultValue</em> and <em>cannot be null</em>:</p>

<pre><code>tableName: {
    fields: {
        id: "integer",
        name: "string"
    }
}
</code></pre>

<h3>
<a id="schema-relations" class="anchor" href="#schema-relations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Schema relations</h3>

<h4>
<a id="extends" class="anchor" href="#extends" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>extends</h4>

<p>Extends is an <strong>inheritance</strong> pattern. It signifies that a table's rows are the <em>child</em> of another table's rows. Concretely, every row object created in this table will use a row object from a parent table as <strong>prototype</strong>.
The <code>extends</code> relationship is also reflected in the parent tables' rows, which will contain a property to the child row. This will allow you to traverse your data trees in both directions (<em>up ancestors and down descendants</em>).</p>

<p><strong>extends example</strong></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> schema <span class="pl-k">=</span> {
    Vehicle<span class="pl-k">:</span> {
        primary<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>,
        fields<span class="pl-k">:</span> {
            id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            maker<span class="pl-k">:</span> { allowNull<span class="pl-k">:</span> <span class="pl-c1">true</span>, dataType<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> }
        }
    },
    Car<span class="pl-k">:</span> {
        primary<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>,
        fields<span class="pl-k">:</span> {
            id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>
        },
        extends<span class="pl-k">:</span> { table<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Vehicle<span class="pl-pds">"</span></span>, localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>, foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> }
    }
};

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rJSON</span>(schema);

<span class="pl-smi">db</span>.<span class="pl-smi">Car</span>.<span class="pl-en">post</span>({
    id<span class="pl-k">:</span> <span class="pl-c1">1</span>,
    year<span class="pl-k">:</span> <span class="pl-c1">2001</span>,
    maker<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Toyota<span class="pl-pds">"</span></span>,
    model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Camry<span class="pl-pds">"</span></span>
});

<span class="pl-smi">db</span>.<span class="pl-smi">Car</span>.<span class="pl-en">get</span>(<span class="pl-c1">1</span>);
<span class="pl-c">/*  own props</span>
<span class="pl-c">    {</span>
<span class="pl-c">        id: 1,</span>
<span class="pl-c">        model: "Camry"</span>
<span class="pl-c">    }</span>
<span class="pl-c">*/</span>

<span class="pl-c">// prototype props</span>
<span class="pl-smi">db</span>.<span class="pl-smi">Car</span>.<span class="pl-en">get</span>(<span class="pl-c1">1</span>).<span class="pl-smi">year</span>; <span class="pl-c">// 2001</span>
<span class="pl-smi">db</span>.<span class="pl-smi">Car</span>.<span class="pl-en">get</span>(<span class="pl-c1">1</span>).<span class="pl-smi">maker</span>; <span class="pl-c">// "Toyota"</span>

<span class="pl-smi">db</span>.<span class="pl-smi">Vehicle</span>.<span class="pl-en">get</span>(<span class="pl-c1">1</span>);
<span class="pl-c">/*</span>
<span class="pl-c">{</span>
<span class="pl-c">    id: 1,</span>
<span class="pl-c">    year: 2001,</span>
<span class="pl-c">    maker: "Toyota",</span>
<span class="pl-c">    Car: {</span>
<span class="pl-c">        id: 1,</span>
<span class="pl-c">        model: "Camry"</span>
<span class="pl-c">    }</span>
<span class="pl-c">}</span>
<span class="pl-c">*/</span></pre></div>

<h4>
<a id="aggregates" class="anchor" href="#aggregates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>aggregates</h4>

<p>This is a composite relation between tables, not inheritance-based. Concretely, if table A "aggregates" table B, rows from table A will have a property pointing to one row (<em>object</em>) or many rows (<em>array</em>) from table B, based on the relations cardinality.
Unlike <code>extends</code>, aggregate does not affect the prototype chain.</p>

<p><strong>aggregates example (single)</strong></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> schema <span class="pl-k">=</span> {
    Vehicle<span class="pl-k">:</span> {
        primary<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>,
        fields<span class="pl-k">:</span> {
            id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            year<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            maker<span class="pl-k">:</span> { allowNull<span class="pl-k">:</span> <span class="pl-c1">true</span>, dataType<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> }
        }
    },
    Client<span class="pl-k">:</span> {
        primary<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>,
        fields<span class="pl-k">:</span> {
            id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>,
            name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>,
            vehicle_id<span class="pl-k">:</span> { allowNull<span class="pl-k">:</span> <span class="pl-c1">true</span>, dataType<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span> }
        },
        aggregates<span class="pl-k">:</span> [
            { table<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Vehicle<span class="pl-pds">"</span></span>, alias<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Vehicle<span class="pl-pds">"</span></span>, localField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>vehicle_id<span class="pl-pds">"</span></span>, foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>, cardinality<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>single<span class="pl-pds">"</span></span> }
        ]
    }
};

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rJSON</span>(schema);

<span class="pl-smi">db</span>.<span class="pl-smi">Vehicle</span>.<span class="pl-en">post</span>({
    id<span class="pl-k">:</span> <span class="pl-c1">1</span>,
    year<span class="pl-k">:</span> <span class="pl-c1">2001</span>,
    maker<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>hyundai<span class="pl-pds">"</span></span>
});

<span class="pl-smi">db</span>.<span class="pl-smi">Client</span>.<span class="pl-en">post</span>({
    id<span class="pl-k">:</span> <span class="pl-c1">2</span>,
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>bob the builder<span class="pl-pds">"</span></span>,
    vehicle_id<span class="pl-k">:</span> <span class="pl-c1">1</span>
});

<span class="pl-smi">db</span>.<span class="pl-smi">Client</span>.<span class="pl-en">get</span>(<span class="pl-c1">2</span>);
<span class="pl-c">/*</span>
<span class="pl-c">{</span>
<span class="pl-c">    id: 2,</span>
<span class="pl-c">    name: "bob the builder",</span>
<span class="pl-c">    Vehicle: {</span>
<span class="pl-c">        id: 1,</span>
<span class="pl-c">        year: 2001,</span>
<span class="pl-c">        maker: "hyundai"</span>
<span class="pl-c">    }</span>
<span class="pl-c">}</span>
<span class="pl-c">*/</span></pre></div>

<hr>

<p><a name="Table"></a></p>

<h2>
<a id="table--object" class="anchor" href="#table--object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table : <code>object</code>
</h2>

<p><strong>Kind</strong>: global typedef<br>
<strong>Summary</strong>: Once relational-json parsed your schema, it will return your relational database, which will be a collection of all the Tables in your data.
Each Table uses an internal Dictionary to store, retrieve and manipulate it's data (rows).
Tables are essentially the interface through which you manipulate data.  </p>

<ul>
<li>
<a href="#Table">Table</a> : <code>object</code>

<ul>
<li>
<a href="#Table+meta">.meta</a> : <code>object</code>
</li>
<li>
<a href="#Table+get">.get()</a> ⇒ <code>object</code> | <code>Array.&lt;object&gt;</code>
</li>
<li>
<a href="#Table+post">.post(d)</a> ⇒ <code>object</code>
</li>
<li>
<a href="#Table+put">.put(d, pkValue)</a> ⇒ <code>object</code>
</li>
<li>
<a href="#Table+delete">.delete(id)</a> ⇒ <code>object</code>
</li>
</ul>
</li>
</ul>

<p><a name="Table+meta"></a></p>

<h3>
<a id="tablemeta--object" class="anchor" href="#tablemeta--object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>table.meta : <code>object</code>
</h3>

<p><strong>Kind</strong>: instance property of <code><a href="#Table">Table</a></code><br>
<strong>Summary</strong>: partial interface into the Table's inner details<br>
<strong>Properties</strong></p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><code>string</code></td>
<td>Table's property key in the relational-json database</td>
</tr>
<tr>
<td>pk</td>
<td><code>string</code></td>
<td>name of the Table's primary field</td>
</tr>
<tr>
<td>primary</td>
<td><code>string</code></td>
<td>alias of Table.meta.pk</td>
</tr>
<tr>
<td>aliasMap</td>
<td><code>object</code></td>
<td>hashmap of the the table's rows' properties pointing to other tables in the relational-json database</td>
</tr>
<tr>
<td>ownRequiredFields</td>
<td><code>Array.&lt;string&gt;</code></td>
<td>list of all own required fields, which must have a value at all times</td>
</tr>
<tr>
<td>allRequiredFields</td>
<td><code>Array.&lt;string&gt;</code></td>
<td>list of all required fields, including own &amp; ancestors' required fields</td>
</tr>
</tbody>
</table>

<p><a name="Table+get"></a></p>

<h3>
<a id="tableget--object--arrayobject" class="anchor" href="#tableget--object--arrayobject" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>table.get() ⇒ <code>object</code> | <code>Array.&lt;object&gt;</code>
</h3>

<p><strong>Kind</strong>: instance method of <code><a href="#Table">Table</a></code><br>
<strong>Summary</strong>: returns row data matching the provided arguments on their primary field value<br>
<strong>Returns</strong>: <code>object</code> | <code>Array.&lt;object&gt;</code> - if no argument is provided, it returns an array of all data within the table.
if 1 argument is provided, it returns that row object
if many arguments are provided, it returns an array containing those row objects<br>
<a name="Table+post"></a></p>

<h3>
<a id="tablepostd--object" class="anchor" href="#tablepostd--object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>table.post(d) ⇒ <code>object</code>
</h3>

<p><strong>Kind</strong>: instance method of <code><a href="#Table">Table</a></code><br>
<strong>Summary</strong>: creates a new row of data<br>
<strong>Returns</strong>: <code>object</code> - row instance created  </p>

<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>d</td>
<td><code>object</code></td>
<td>data bundle, must contain all required fields</td>
</tr>
</tbody>
</table>

<p><a name="Table+put"></a></p>

<h3>
<a id="tableputd-pkvalue--object" class="anchor" href="#tableputd-pkvalue--object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>table.put(d, pkValue) ⇒ <code>object</code>
</h3>

<p><strong>Kind</strong>: instance method of <code><a href="#Table">Table</a></code><br>
<strong>Summary</strong>: modifies a data row, by re-creating the row merged with the new data<br>
<strong>Returns</strong>: <code>object</code> - newly created row  </p>

<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>d</td>
<td><code>object</code></td>
<td></td>
<td>field:value object of data to modify</td>
</tr>
<tr>
<td>pkValue</td>
<td><code>*</code></td>
<td><code>d.primary</code></td>
<td>primary value to find row to modify</td>
</tr>
</tbody>
</table>

<p><a name="Table+delete"></a></p>

<h3>
<a id="tabledeleteid--object" class="anchor" href="#tabledeleteid--object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>table.delete(id) ⇒ <code>object</code>
</h3>

<p><strong>Kind</strong>: instance method of <code><a href="#Table">Table</a></code><br>
<strong>Summary</strong>: recursively deletes the target row and it's children (if any)<br>
<strong>Returns</strong>: <code>object</code> - deleted row  </p>

<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td><code>*</code></td>
<td>primary field value of row to delete</td>
</tr>
</tbody>
</table>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/SebastienDaniel/relational-json">relational-json</a> is maintained by <a href="https://github.com/SebastienDaniel">SebastienDaniel</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
